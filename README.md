# Retro Board

Доска для ретроспектив в реальном времени. Создай доску, отправь ссылку команде и работайте вместе — без регистрации.

## Возможности

- **Три колонки**: Что прошло хорошо, Что пошло не так, Что улучшить
- **Совместная работа** в реальном времени через WebSocket (Socket.IO)
- **Голосование** (лайк/дизлайк) и **комментарии** к карточкам
- **Таймер** для ограничения обсуждений по времени
- **Тёмная тема**
- **Экспорт** доски в JSON

## Безопасность

### Сквозное шифрование (E2E)

Содержимое карточек, имена авторов и комментарии шифруются на клиенте алгоритмом AES-256-GCM перед отправкой на сервер. Ключ шифрования хранится во фрагменте URL (`#key`) — браузеры никогда не отправляют фрагмент на сервер, поэтому сервер хранит только шифротекст.

- При создании доски ключ генерируется автоматически: `https://example.com/abc123#<ключ>`
- Делитесь полной ссылкой (с `#ключом`) с командой
- Без фрагмента в URL расшифровать содержимое карточек невозможно
- Старые доски, созданные до шифрования, продолжают работать (нешифрованный режим)

### Подписанные сессии

Идентификаторы сессий подписываются сервером через HMAC-SHA256. Сервер генерирует и проверяет токены — клиент не может подделать sessionId для манипуляции голосами.

### Ограничение частоты запросов

Лимиты на каждый сокет: 30 созданий карточек/мин, 60 голосов/мин и т.д. При превышении возвращается ошибка.

### Валидация входных данных

Все события сокета проверяются на стороне сервера: типы данных, длина строк (контент до 5000 символов, имя автора до 100), формат UUID, допустимые значения enum.

### Заголовки безопасности

`X-Frame-Options: DENY`, `X-Content-Type-Options: nosniff`, `X-Robots-Tag: noindex, nofollow`

## Установка

### Требования

- Node.js 18+
- PostgreSQL

### Переменные окружения

Скопируйте `.env.example` в `.env` и настройте:

```
DATABASE_URL=postgresql://retro:retro@localhost:5432/retro
PORT=3000
ORIGIN=http://localhost:3000
SESSION_SECRET=           # генерируется автоматически, если пусто
```

В продакшене задайте `SESSION_SECRET` явно, чтобы сессии сохранялись при перезапуске сервера.

### Запуск

```sh
npm install
npm run build
node server.js
```

### Разработка

```sh
npm run dev
```

## Архитектура

- **Фронтенд**: SvelteKit (Svelte 5 runes)
- **Бэкенд**: Node.js HTTP-сервер с Socket.IO + SvelteKit handler
- **База данных**: PostgreSQL через Drizzle ORM
- **Шифрование**: Web Crypto API (AES-256-GCM), ключ во фрагменте URL
